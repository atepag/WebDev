{"ast":null,"code":"const functions = require(\"firebase-functions\");\n\nconst cors = require(\"cors\")({\n  origin: true\n});\n\nconst cheerio = require(\"cheerio\");\n\nconst getUrls = require(\"get-urls\");\n\nconst fetch = require(\"node-fetch\");\n\nconst scrapeMetatags = text => {\n  const urls = Array.from(getUrls(text));\n  const requests = urls.map(async url => {\n    const res = await fetch(url);\n    const html = await res.text();\n    const $ = cheerio.load(html);\n\n    const getMetatag = name => $(`meta[name=${name}]`).attr(\"content\") || $(`meta[property=\"og:${name}\"]`).attr(\"content\") || $(`meta[property=\"twitter:${name}\"]`).attr(\"content\");\n\n    return {\n      url,\n      title: $(\"title\").first().text(),\n      favicon: $('link[rel=\"shortcut icon\"]').attr(\"href\"),\n      // description: $('meta[name=description]').attr('content'),\n      description: getMetatag(\"description\"),\n      image: getMetatag(\"image\"),\n      author: getMetatag(\"author\")\n    };\n  });\n  return Promise.all(requests);\n};\n\nexports.scraper = functions.https.onRequest((request, response) => {\n  cors(request, response, async () => {\n    const body = JSON.parse(request.body);\n    const data = await scrapeMetatags(body.text);\n    response.send(data);\n  });\n});","map":{"version":3,"sources":["/Users/a3506/Documents/WebDev/Map/WebDev/covid_map/src/scrapping.js"],"names":["functions","require","cors","origin","cheerio","getUrls","fetch","scrapeMetatags","text","urls","Array","from","requests","map","url","res","html","$","load","getMetatag","name","attr","title","first","favicon","description","image","author","Promise","all","exports","scraper","https","onRequest","request","response","body","JSON","parse","data","send"],"mappings":"AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,oBAAD,CAAzB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAAP,CAAgB;AAAEE,EAAAA,MAAM,EAAE;AAAV,CAAhB,CAAb;;AAEA,MAAMC,OAAO,GAAGH,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMI,OAAO,GAAGJ,OAAO,CAAC,UAAD,CAAvB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAC,YAAD,CAArB;;AAEA,MAAMM,cAAc,GAAIC,IAAD,IAAU;AAC/B,QAAMC,IAAI,GAAGC,KAAK,CAACC,IAAN,CAAWN,OAAO,CAACG,IAAD,CAAlB,CAAb;AAEA,QAAMI,QAAQ,GAAGH,IAAI,CAACI,GAAL,CAAS,MAAOC,GAAP,IAAe;AACvC,UAAMC,GAAG,GAAG,MAAMT,KAAK,CAACQ,GAAD,CAAvB;AAEA,UAAME,IAAI,GAAG,MAAMD,GAAG,CAACP,IAAJ,EAAnB;AACA,UAAMS,CAAC,GAAGb,OAAO,CAACc,IAAR,CAAaF,IAAb,CAAV;;AAEA,UAAMG,UAAU,GAAIC,IAAD,IACjBH,CAAC,CAAE,aAAYG,IAAK,GAAnB,CAAD,CAAwBC,IAAxB,CAA6B,SAA7B,KACAJ,CAAC,CAAE,qBAAoBG,IAAK,IAA3B,CAAD,CAAiCC,IAAjC,CAAsC,SAAtC,CADA,IAEAJ,CAAC,CAAE,0BAAyBG,IAAK,IAAhC,CAAD,CAAsCC,IAAtC,CAA2C,SAA3C,CAHF;;AAKA,WAAO;AACLP,MAAAA,GADK;AAELQ,MAAAA,KAAK,EAAEL,CAAC,CAAC,OAAD,CAAD,CAAWM,KAAX,GAAmBf,IAAnB,EAFF;AAGLgB,MAAAA,OAAO,EAAEP,CAAC,CAAC,2BAAD,CAAD,CAA+BI,IAA/B,CAAoC,MAApC,CAHJ;AAIL;AACAI,MAAAA,WAAW,EAAEN,UAAU,CAAC,aAAD,CALlB;AAMLO,MAAAA,KAAK,EAAEP,UAAU,CAAC,OAAD,CANZ;AAOLQ,MAAAA,MAAM,EAAER,UAAU,CAAC,QAAD;AAPb,KAAP;AASD,GApBgB,CAAjB;AAsBA,SAAOS,OAAO,CAACC,GAAR,CAAYjB,QAAZ,CAAP;AACD,CA1BD;;AA4BAkB,OAAO,CAACC,OAAR,GAAkB/B,SAAS,CAACgC,KAAV,CAAgBC,SAAhB,CAA0B,CAACC,OAAD,EAAUC,QAAV,KAAuB;AACjEjC,EAAAA,IAAI,CAACgC,OAAD,EAAUC,QAAV,EAAoB,YAAY;AAClC,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWJ,OAAO,CAACE,IAAnB,CAAb;AACA,UAAMG,IAAI,GAAG,MAAMhC,cAAc,CAAC6B,IAAI,CAAC5B,IAAN,CAAjC;AAEA2B,IAAAA,QAAQ,CAACK,IAAT,CAAcD,IAAd;AACD,GALG,CAAJ;AAMD,CAPiB,CAAlB","sourcesContent":["const functions = require(\"firebase-functions\");\nconst cors = require(\"cors\")({ origin: true });\n\nconst cheerio = require(\"cheerio\");\nconst getUrls = require(\"get-urls\");\nconst fetch = require(\"node-fetch\");\n\nconst scrapeMetatags = (text) => {\n  const urls = Array.from(getUrls(text));\n\n  const requests = urls.map(async (url) => {\n    const res = await fetch(url);\n\n    const html = await res.text();\n    const $ = cheerio.load(html);\n\n    const getMetatag = (name) =>\n      $(`meta[name=${name}]`).attr(\"content\") ||\n      $(`meta[property=\"og:${name}\"]`).attr(\"content\") ||\n      $(`meta[property=\"twitter:${name}\"]`).attr(\"content\");\n\n    return {\n      url,\n      title: $(\"title\").first().text(),\n      favicon: $('link[rel=\"shortcut icon\"]').attr(\"href\"),\n      // description: $('meta[name=description]').attr('content'),\n      description: getMetatag(\"description\"),\n      image: getMetatag(\"image\"),\n      author: getMetatag(\"author\"),\n    };\n  });\n\n  return Promise.all(requests);\n};\n\nexports.scraper = functions.https.onRequest((request, response) => {\n  cors(request, response, async () => {\n    const body = JSON.parse(request.body);\n    const data = await scrapeMetatags(body.text);\n\n    response.send(data);\n  });\n});\n"]},"metadata":{},"sourceType":"module"}